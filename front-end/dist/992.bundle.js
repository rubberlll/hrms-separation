"use strict";(self.webpackChunkmy_pra=self.webpackChunkmy_pra||[]).push([[992],{2992:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var r=n(6540),a=n(9381),l=n(3532),i=n(6914),o=n(2702),s=n(2941),c=n(677),m=n(5423),d=n(6945),u=n(5957),p=n(1100),y=(n(136),n(7917),n(9298));const{Title:E}=a.A;p.EA.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${p.rE}/pdf.worker.min.js`;const f=()=>{const[e,t]=(0,r.useState)(null),[n,p]=(0,r.useState)(!1),[f,w]=(0,r.useState)(0),[h,k]=(0,r.useState)(1),[v,A]=(0,r.useState)(!1),[I,b]=(0,r.useState)(!1),[g,P]=(0,r.useState)([]);(0,r.useEffect)((()=>{S()}),[]);const S=async()=>{b(!0);try{const e=await y.A.get("/resumes");if(200===e.data.code){const t=e.data.data.map((e=>({id:e._id,name:e.userId?.username||"未知",position:e.jobId?.title||"未知职位",email:e.userId?.email||"",phone:e.userId?.phone||"",status:e.status,submitTime:new Date(e.submittedAt).toLocaleString(),fileUrl:e.fileUrl,fileName:e.fileName,education:e.education,workExperience:e.workExperience,skills:e.skills,jobId:e.jobId?._id,userId:e.userId?._id,interviewProcess:e.interviewProcess,employmentInfo:e.employmentInfo})));P(t)}}catch(e){console.error("获取简历列表失败:",e)}finally{b(!1)}},j=async(t,n)=>{try{if(200===(await y.A.put(`/resumes/${t}`,{status:n})).data.code){if(l.Ay.success("更新状态成功"),"hired"===n&&e)try{200===(await y.A.put(`/users/${e.userId}`,{role:"employee",status:"active"})).data.code&&l.Ay.success("已将用户角色更新为员工")}catch(e){console.error("更新用户角色失败:",e),l.Ay.error("更新用户角色失败")}S()}}catch(e){console.error("更新简历状态失败:",e)}},C=e=>({pending:"gold",reviewed:"blue",hired:"green",rejected:"red"}[e]||"default"),T=[{title:"姓名",dataIndex:"name",key:"name"},{title:"应聘职位",dataIndex:"position",key:"position"},{title:"投递时间",dataIndex:"submitTime",key:"submitTime",sorter:(e,t)=>new Date(e.submitTime).getTime()-new Date(t.submitTime).getTime()},{title:"状态",dataIndex:"status",key:"status",render:e=>r.createElement(i.A,{color:C(e)},(e=>({pending:"待处理",reviewed:"已审核",hired:"已录用",rejected:"已拒绝"}[e]||e))(e))},{title:"操作",key:"action",render:(e,n)=>r.createElement(o.A,null,r.createElement(s.Ay,{type:"link",onClick:()=>{t(n),p(!0)}},"查看详情"),r.createElement(s.Ay,{type:"link",onClick:()=>{t(n),A(!0)}},"查看简历附件"))}],x=e=>e.startsWith("http://")||e.startsWith("https://")?e:e.includes("/api/files/")?e.replace("/api/files/","/api/files/"):e.startsWith("/files/")?`/api${e}`:e.startsWith("/api")?e:`/api${e}`;return r.createElement("div",{style:{padding:24}},r.createElement(c.A,null,r.createElement(E,{level:3},"简历管理"),r.createElement(m.A,{columns:T,dataSource:g,rowKey:"id",loading:I,pagination:{pageSize:10,showTotal:e=>`共 ${e} 条记录`}})),r.createElement(d.A,{title:"简历详情",open:n,onCancel:()=>p(!1),width:800,footer:[r.createElement(s.Ay,{key:"back",onClick:()=>p(!1)},"关闭"),r.createElement(s.Ay,{key:"updateStatus",onClick:()=>{e&&(j(e.id,"reviewed"),p(!1))}},"标记为已审核"),r.createElement(s.Ay,{key:"reject",danger:!0,onClick:()=>{e&&(j(e.id,"rejected"),p(!1))}},"拒绝"),r.createElement(s.Ay,{key:"hire",type:"primary",onClick:async()=>{if(e){if(await(async e=>{try{const t=await y.A.get(`/resumes/user/${e}`);return 200===t.data.code&&t.data.data.some((e=>"hired"===e.status))}catch(e){return console.error("检查用户录用状态失败:",e),!1}})(e.userId))return void l.Ay.warning("该用户已有被录用的简历，无法重复录用");j(e.id,"hired"),p(!1)}}},"录用")]},e&&r.createElement(u.A,{column:2,bordered:!0},r.createElement(u.A.Item,{label:"姓名",span:2},e.name),r.createElement(u.A.Item,{label:"应聘职位",span:2},e.position),r.createElement(u.A.Item,{label:"邮箱"},e.email),r.createElement(u.A.Item,{label:"电话"},e.phone),r.createElement(u.A.Item,{label:"教育背景",span:2},e.education?.school," -"," ",e.education?.major,r.createElement("br",null),e.education?.degree," ·"," ",e.education?.graduationYear,"年毕业"),r.createElement(u.A.Item,{label:"工作经历",span:2},e.workExperience?.map(((e,t)=>r.createElement("div",{key:t,style:{marginBottom:16}},r.createElement("strong",null,e.company)," - ",e.position,r.createElement("br",null),e.duration,r.createElement("br",null),e.description)))),e.interviewProcess&&r.createElement(u.A.Item,{label:"面试进度",span:2},r.createElement(o.A,{direction:"vertical",style:{width:"100%"}},r.createElement("div",null,"当前阶段：",e.interviewProcess.currentStage),e.interviewProcess.interviewDate&&r.createElement("div",null,"面试时间：",e.interviewProcess.interviewDate),e.interviewProcess.interviewer&&r.createElement("div",null,"面试官：",e.interviewProcess.interviewer),e.interviewProcess.feedback&&r.createElement("div",null,"面试反馈：",e.interviewProcess.feedback))),e.employmentInfo&&r.createElement(u.A.Item,{label:"录用信息",span:2},r.createElement(o.A,{direction:"vertical",style:{width:"100%"}},e.employmentInfo.employmentDate&&r.createElement("div",null,"入职日期：",e.employmentInfo.employmentDate),e.employmentInfo.department&&r.createElement("div",null,"入职部门：",e.employmentInfo.department),e.employmentInfo.position&&r.createElement("div",null,"职位：",e.employmentInfo.position),e.employmentInfo.salary&&r.createElement("div",null,"薪资：",e.employmentInfo.salary),e.employmentInfo.probationPeriod&&r.createElement("div",null,"试用期：",e.employmentInfo.probationPeriod),e.employmentInfo.contractPeriod&&r.createElement("div",null,"合同期限：",e.employmentInfo.contractPeriod))))),r.createElement(d.A,{title:"简历附件",open:v,onCancel:()=>A(!1),width:1e3,footer:[r.createElement(s.Ay,{key:"close",onClick:()=>A(!1)},"关闭"),r.createElement(s.Ay,{key:"download",type:"primary",onClick:()=>e&&window.open(x(e.fileUrl))},"下载")],styles:{body:{height:"80vh"}}},e&&r.createElement("div",{style:{height:"100%",width:"100%"}},r.createElement(a.A.Text,{strong:!0,style:{display:"block",marginBottom:10}},"文件名：",e.fileName),r.createElement("iframe",{src:x(e.fileUrl),style:{width:"100%",height:"70vh",border:"none"},title:"简历预览"},r.createElement("p",null,"您的浏览器不支持iframe。",r.createElement("a",{href:x(e.fileUrl),target:"_blank",rel:"noreferrer"},"点击下载"))))))}}}]);
//# sourceMappingURL=992.bundle.js.map