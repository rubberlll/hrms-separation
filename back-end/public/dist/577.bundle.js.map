{"version":3,"file":"577.bundle.js","mappings":"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","sources":["webpack://my_pra/./src/pages/PermissionManagement.tsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport {\n  Table,\n  Button,\n  Modal,\n  Form,\n  Input,\n  Select,\n  message,\n  Space,\n} from \"antd\";\nimport type { ColumnsType } from \"antd/es/table\";\nimport request from \"../utils/request\";\n\ninterface User {\n  id: string;\n  key: string;\n  username: string;\n  role: string;\n  email: string;\n  phone?: string;\n  status: \"active\" | \"inactive\" | \"pending\";\n  department?: string;\n  departmentId?: string;\n  employmentType?: \"全职\" | \"兼职\" | \"实习\";\n  entryDate?: string;\n  avatar?: string;\n  createdAt: string;\n}\n\nconst PermissionManagement: React.FC = () => {\n  const [users, setUsers] = useState<User[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [modalVisible, setModalVisible] = useState(false);\n  const [passwordModalVisible, setPasswordModalVisible] = useState(false);\n  const [currentUser, setCurrentUser] = useState<User | null>(null);\n  const [form] = Form.useForm();\n  const [passwordForm] = Form.useForm();\n  const [searchForm] = Form.useForm();\n  const [filteredUsers, setFilteredUsers] = useState<User[]>([]);\n\n  // 获取所有用户数据\n  const fetchUsers = async () => {\n    setLoading(true);\n    try {\n      const response = await request.get(\"/users\");\n      setUsers(response.data.data);\n      setFilteredUsers(response.data.data);\n    } catch (error) {\n      console.error(\"获取用户列表失败:\", error);\n      message.error(\"获取用户列表失败\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchUsers();\n  }, []);\n\n  // 搜索用户\n  const handleSearch = (values: any) => {\n    const { username, role } = values;\n    let result = [...users];\n\n    if (username) {\n      result = result.filter((user) =>\n        user.username.toLowerCase().includes(username.toLowerCase())\n      );\n    }\n\n    if (role) {\n      result = result.filter((user) => user.role === role);\n    }\n\n    setFilteredUsers(result);\n  };\n\n  // 重置搜索\n  const handleReset = () => {\n    searchForm.resetFields();\n    setFilteredUsers(users);\n  };\n\n  // 打开编辑权限模态框\n  const showEditModal = (user: User) => {\n    setCurrentUser(user);\n    form.setFieldsValue({\n      username: user.username,\n      role: user.role,\n      status: user.status,\n    });\n    setModalVisible(true);\n  };\n\n  // 打开修改密码模态框\n  const showPasswordModal = (user: User) => {\n    setCurrentUser(user);\n    passwordForm.resetFields();\n    setPasswordModalVisible(true);\n  };\n\n  // 更新用户权限\n  const handleUpdatePermission = async (values: any) => {\n    if (!currentUser) return;\n\n    try {\n      await request.put(`/users/${currentUser.id || currentUser.key}`, {\n        role: values.role,\n        status: values.status,\n      });\n      message.success(\"权限更新成功\");\n      setModalVisible(false);\n      fetchUsers(); // 刷新用户列表\n    } catch (error) {\n      console.error(\"更新权限失败:\", error);\n      message.error(\"更新权限失败\");\n    }\n  };\n\n  // 更新用户密码\n  const handleUpdatePassword = async (values: any) => {\n    if (!currentUser) return;\n\n    try {\n      await request.put(`/users`, {\n        userId: currentUser.id || currentUser.key,\n        password: values.password,\n      });\n      message.success(\"密码更新成功\");\n      setPasswordModalVisible(false);\n    } catch (error) {\n      console.error(\"更新密码失败:\", error);\n      message.error(\"更新密码失败\");\n    }\n  };\n\n  const columns: ColumnsType<User> = [\n    {\n      title: \"用户名\",\n      dataIndex: \"username\",\n      key: \"username\",\n      width: 120,\n    },\n    {\n      title: \"角色\",\n      dataIndex: \"role\",\n      key: \"role\",\n      width: 100,\n      render: (role) => {\n        const roleMap: Record<string, string> = {\n          admin: \"管理员\",\n          hr: \"HR\",\n          employee: \"员工\",\n          user: \"普通用户\",\n        };\n        return roleMap[role] || role;\n      },\n    },\n    {\n      title: \"邮箱\",\n      dataIndex: \"email\",\n      key: \"email\",\n      width: 180,\n      ellipsis: true,\n    },\n    {\n      title: \"电话\",\n      dataIndex: \"phone\",\n      key: \"phone\",\n      width: 120,\n      render: (phone) => phone || \"-\",\n    },\n    {\n      title: \"部门\",\n      dataIndex: \"department\",\n      key: \"department\",\n      render: (department) => department || \"-\",\n    },\n    {\n      title: \"状态\",\n      dataIndex: \"status\",\n      key: \"status\",\n      render: (status) => {\n        const statusMap: Record<string, string> = {\n          active: \"激活\",\n          inactive: \"禁用\",\n          pending: \"待审核\",\n        };\n        return statusMap[status] || status;\n      },\n    },\n    {\n      title: \"入职日期\",\n      dataIndex: \"entryDate\",\n      key: \"entryDate\",\n      render: (text) => text || \"-\",\n    },\n    {\n      title: \"雇佣类型\",\n      dataIndex: \"employmentType\",\n      key: \"employmentType\",\n      render: (type) => type || \"-\",\n    },\n    {\n      title: \"创建时间\",\n      dataIndex: \"createdAt\",\n      key: \"createdAt\",\n      render: (text) => new Date(text).toLocaleString(),\n    },\n    {\n      title: \"操作\",\n      key: \"action\",\n      width: 200,\n      render: (_, record) => (\n        <Space size=\"middle\">\n          <Button type=\"link\" onClick={() => showEditModal(record)}>\n            修改权限\n          </Button>\n          <Button type=\"link\" onClick={() => showPasswordModal(record)}>\n            重置密码\n          </Button>\n        </Space>\n      ),\n    },\n  ];\n\n  return (\n    <div className=\"permission-management-container\">\n      <h1>权限管理</h1>\n\n      {/* 搜索表单 */}\n      <div style={{ marginBottom: 16 }}>\n        <Form form={searchForm} layout=\"inline\" onFinish={handleSearch}>\n          <Form.Item name=\"username\" label=\"用户名\">\n            <Input placeholder=\"请输入用户名\" allowClear />\n          </Form.Item>\n          <Form.Item name=\"role\" label=\"角色\">\n            <Select placeholder=\"请选择角色\" allowClear style={{ width: 150 }}>\n              <Select.Option value=\"admin\">管理员</Select.Option>\n              <Select.Option value=\"hr\">HR</Select.Option>\n              <Select.Option value=\"employee\">员工</Select.Option>\n              <Select.Option value=\"user\">普通用户</Select.Option>\n            </Select>\n          </Form.Item>\n          <Form.Item>\n            <Button type=\"primary\" htmlType=\"submit\">\n              搜索\n            </Button>\n          </Form.Item>\n          <Form.Item>\n            <Button onClick={handleReset}>重置</Button>\n          </Form.Item>\n        </Form>\n      </div>\n\n      <Table\n        columns={columns}\n        dataSource={filteredUsers}\n        rowKey={(record) => record.id || record.key}\n        loading={loading}\n        pagination={{\n          pageSize: 10,\n          showQuickJumper: true,\n          showSizeChanger: true,\n          pageSizeOptions: [\"10\", \"20\", \"50\"],\n          showTotal: (total) => `共 ${total} 条记录`,\n        }}\n        scroll={{ x: 1300 }}\n        bordered\n      />\n\n      {/* 修改权限模态框 */}\n      <Modal\n        title=\"修改用户权限\"\n        open={modalVisible}\n        onCancel={() => setModalVisible(false)}\n        footer={null}\n      >\n        <Form form={form} layout=\"vertical\" onFinish={handleUpdatePermission}>\n          <Form.Item name=\"username\" label=\"用户名\">\n            <Input disabled />\n          </Form.Item>\n          <Form.Item\n            name=\"role\"\n            label=\"角色\"\n            rules={[{ required: true, message: \"请选择角色\" }]}\n          >\n            <Select>\n              <Select.Option value=\"admin\">管理员</Select.Option>\n              <Select.Option value=\"hr\">HR</Select.Option>\n              <Select.Option value=\"employee\">员工</Select.Option>\n              <Select.Option value=\"user\">普通用户</Select.Option>\n            </Select>\n          </Form.Item>\n          <Form.Item\n            name=\"status\"\n            label=\"状态\"\n            rules={[{ required: true, message: \"请选择状态\" }]}\n          >\n            <Select>\n              <Select.Option value=\"active\">激活</Select.Option>\n              <Select.Option value=\"inactive\">禁用</Select.Option>\n              <Select.Option value=\"pending\">待审核</Select.Option>\n            </Select>\n          </Form.Item>\n          <Form.Item>\n            <Button type=\"primary\" htmlType=\"submit\">\n              保存\n            </Button>\n          </Form.Item>\n        </Form>\n      </Modal>\n\n      {/* 修改密码模态框 */}\n      <Modal\n        title=\"重置用户密码\"\n        open={passwordModalVisible}\n        onCancel={() => setPasswordModalVisible(false)}\n        footer={null}\n      >\n        <Form\n          form={passwordForm}\n          layout=\"vertical\"\n          onFinish={handleUpdatePassword}\n        >\n          <Form.Item\n            name=\"password\"\n            label=\"新密码\"\n            rules={[\n              { required: true, message: \"请输入新密码\" },\n              { min: 6, message: \"密码长度不能少于6个字符\" },\n            ]}\n          >\n            <Input.Password />\n          </Form.Item>\n          <Form.Item\n            name=\"confirmPassword\"\n            label=\"确认密码\"\n            dependencies={[\"password\"]}\n            rules={[\n              { required: true, message: \"请确认密码\" },\n              ({ getFieldValue }) => ({\n                validator(_, value) {\n                  if (!value || getFieldValue(\"password\") === value) {\n                    return Promise.resolve();\n                  }\n                  return Promise.reject(new Error(\"两次输入的密码不一致\"));\n                },\n              }),\n            ]}\n          >\n            <Input.Password />\n          </Form.Item>\n          <Form.Item>\n            <Button type=\"primary\" htmlType=\"submit\">\n              保存\n            </Button>\n          </Form.Item>\n        </Form>\n      </Modal>\n    </div>\n  );\n};\n\nexport default PermissionManagement;\n"],"names":["PermissionManagement","users","setUsers","useState","loading","setLoading","modalVisible","setModalVisible","passwordModalVisible","setPasswordModalVisible","currentUser","setCurrentUser","form","Form","useForm","passwordForm","searchForm","filteredUsers","setFilteredUsers","fetchUsers","async","response","request","get","data","error","console","message","useEffect","columns","title","dataIndex","key","width","render","role","admin","hr","employee","user","ellipsis","phone","department","status","active","inactive","pending","text","type","Date","toLocaleString","_","record","React","Space","size","Button","onClick","showEditModal","setFieldsValue","username","resetFields","className","style","marginBottom","layout","onFinish","values","result","filter","toLowerCase","includes","Item","name","label","Input","placeholder","allowClear","Select","Option","value","htmlType","handleReset","Table","dataSource","rowKey","id","pagination","pageSize","showQuickJumper","showSizeChanger","pageSizeOptions","showTotal","total","scroll","x","bordered","Modal","open","onCancel","footer","put","success","disabled","rules","required","userId","password","min","Password","dependencies","getFieldValue","validator","Promise","reject","Error","resolve"],"sourceRoot":""}