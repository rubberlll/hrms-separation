"use strict";(self.webpackChunkmy_pra=self.webpackChunkmy_pra||[]).push([[46],{2046:(e,t,a)=>{a.r(t),a.d(t,{default:()=>w});var n=a(6540),r=a(4054),l=a(3532),c=a(6337),s=a(9029),m=a(677),o=a(7152),i=a(6370),d=a(9957),p=a(5739),u=a(2941),E=a(9381),y=a(2702),A=a(6207),g=a(7028),h=a(9298),b=a(4353),f=a.n(b);function k(){return k=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},k.apply(null,arguments)}const w=()=>{const[e]=r.A.useForm(),[t,a]=(0,n.useState)(!1),[b,w]=(0,n.useState)([]),[T,x]=(0,n.useState)(!1),[v,C]=(0,n.useState)([]),[I,S]=(0,n.useState)(null),[L,j]=(0,n.useState)("list"),[D,R]=(0,n.useState)(""),[F,_]=(0,n.useState)("all"),[B,$]=(0,n.useState)([]),[q,O]=(0,n.useState)([{}]),[M,N]=(0,n.useState)([{}]),[P,Y]=(0,n.useState)([]);(0,n.useEffect)((()=>{(async()=>{x(!0);try{const e=await h.A.get("/jobs");w(e.data.data||[])}catch(e){console.error("获取职位列表失败:",e),l.Ay.error("获取职位列表失败")}finally{x(!1)}})(),(async()=>{try{const e=await h.A.get("/departments");$(e.data.data||[])}catch(e){console.error("获取部门列表失败:",e)}})()}),[]);const z={customRequest:async({file:e,onSuccess:t,onError:n})=>{const r=1048576,c=Math.ceil(e.size/r);a(!0);try{const a=async()=>{for(let t=0;t<c;t++){const a=t*r,n=Math.min(e.size,a+r),l=e.slice(a,n),s=new FormData;s.append("chunk",l),s.append("fileName",e.name),s.append("chunkIndex",String(t)),s.append("chunks",String(c));let m=3;for(;m>0;)try{const e=await h.A.post("/upload/chunk",s,{headers:{"Content-Type":"multipart/form-data"}});if(200!==e.status)throw new Error(`上传失败: ${e.statusText}`);break}catch(e){if(m--,0===m)throw e;await new Promise((e=>setTimeout(e,1e3)))}}return(await h.A.post("/upload/merge",{fileName:e.name,chunks:c})).data.data},n=await a();return t(n),l.Ay.success(`${e.name} 上传成功`),n}catch(t){console.error("上传错误详情:",t),n(t),l.Ay.error(`${e.name} 上传失败: ${t.message||"未知错误"}`)}finally{a(!1)}},beforeUpload:e=>"application/pdf"!==e.type?(l.Ay.error("只能上传 PDF 文件！"),c.A.LIST_IGNORE):!!(e.size/1024/1024<20)||(l.Ay.error("文件大小不能超过 20MB！"),c.A.LIST_IGNORE)},G=b.filter((e=>{if("open"!==e.status)return!1;const t=!D||e.title.toLowerCase().includes(D.toLowerCase())||e.description.toLowerCase().includes(D.toLowerCase())||e.location.toLowerCase().includes(D.toLowerCase()),a="object"==typeof e.department&&e.department?e.department._id:e.department;return t&&("all"===F||a===F)})),U=e=>"object"==typeof e.department&&e.department?e.department.name:e.department||"未分配";return n.createElement("div",{style:{maxWidth:800,margin:"0 auto",padding:"24px"}},"list"===L?n.createElement(n.Fragment,null,n.createElement("h2",null,"职位列表"),n.createElement(s.A,{spinning:T},n.createElement(m.A,{style:{marginBottom:16}},n.createElement(o.A,{gutter:[16,16]},n.createElement(i.A,{span:12},n.createElement(d.A.Search,{placeholder:"搜索职位名称、描述或地点",value:D,onChange:e=>R(e.target.value),onSearch:e=>R(e),allowClear:!0})),n.createElement(i.A,{span:8},n.createElement(p.A,{placeholder:"按部门筛选",style:{width:"100%"},value:F,onChange:e=>_(e)},n.createElement(p.A.Option,{value:"all"},"全部部门"),B.map((e=>n.createElement(p.A.Option,{key:e._id,value:e._id},e.name))))),n.createElement(i.A,{span:4},n.createElement(u.Ay,{onClick:()=>{R(""),_("all")}},"重置筛选")))),0===G.length?n.createElement(m.A,null,n.createElement(E.A.Text,null,"暂无招聘中的职位")):n.createElement(y.A,{direction:"vertical",style:{width:"100%"}},G.map((t=>n.createElement(m.A,{key:t._id},n.createElement(o.A,{justify:"space-between",align:"middle"},n.createElement(i.A,null,n.createElement(E.A.Title,{level:4,style:{margin:0}},t.title,n.createElement(E.A.Text,{type:"success",style:{fontSize:"14px",marginLeft:"10px"}},"招聘中")),n.createElement(E.A.Text,{type:"secondary"},U(t)," · ",t.location,t.jobType&&` · ${t.jobType}`),t.salaryRange&&n.createElement(E.A.Text,{type:"success",style:{display:"block",marginTop:8}},t.salaryRange)),n.createElement(i.A,null,n.createElement(u.Ay,{type:"primary",onClick:()=>(t=>{S(t),j("apply"),e.resetFields()})(t)},"申请职位"))),n.createElement(E.A.Paragraph,{style:{marginTop:16}},n.createElement("strong",null,"职位描述："),n.createElement("br",null),t.description),t.expiryDate&&n.createElement(E.A.Text,{type:"secondary"},"截止日期: ",f()(t.expiryDate).format("YYYY-MM-DD")))))))):n.createElement(n.Fragment,null,n.createElement("div",{style:{marginBottom:16}},n.createElement(u.Ay,{icon:n.createElement(A.A,null),onClick:()=>{j("list"),S(null),e.resetFields(),C([])},style:{marginRight:16}},"返回"),n.createElement(E.A.Title,{level:3,style:{display:"inline-block",margin:0}},"职位申请"),n.createElement(E.A.Text,{style:{marginLeft:8}},I?.title)),n.createElement(m.A,{style:{marginBottom:16}},n.createElement(E.A.Title,{level:4},I?.title),n.createElement(E.A.Text,{type:"secondary"},U(I)," · ",I?.location,I?.jobType&&` · ${I?.jobType}`),I?.salaryRange&&n.createElement(E.A.Text,{type:"success",style:{display:"block",marginTop:8}},I?.salaryRange),n.createElement(E.A.Paragraph,{style:{marginTop:16}},n.createElement("strong",null,"职位描述："),n.createElement("br",null),I?.description)),n.createElement(r.A,{form:e,onFinish:async t=>{try{if(0===v.length)return void l.Ay.error("请上传简历文件");const a=v[0].response||{},n=t.workExperience?.map((e=>({company:e.company,position:e.position,duration:`${e.startDate||""} - ${e.endDate||""}`,description:e.description})))||[],r=t.education?.[0]?{school:t.education[0].school,major:t.education[0].major,degree:t.education[0].degree,graduationYear:t.education[0].endDate?.split("-")[0]||""}:void 0,c={jobId:I._id,fileUrl:a.url,fileName:v[0].name,coverLetter:t.coverLetter,status:"pending",submittedAt:new Date,workExperience:n,education:r,skills:t.skills||[]};await h.A.post("/resumes",c),l.Ay.success("简历提交成功！"),e.resetFields(),C([]),j("list"),S(null),O([{}]),N([{}]),Y([])}catch(e){console.error("提交失败:",e),l.Ay.error("提交失败，请重试")}},layout:"vertical"},n.createElement(r.A.Item,{name:"resume",label:"上传简历",rules:[{required:!0,message:"请上传简历"}]},n.createElement(c.A,k({},z,{maxCount:1,accept:".pdf",fileList:v,onChange:({fileList:e})=>C(e)}),n.createElement(u.Ay,{icon:n.createElement(g.A,null),loading:t},"选择文件"))),n.createElement(m.A,{title:"工作经验",style:{marginBottom:16}},q.map(((e,t)=>n.createElement("div",{key:t,style:{marginBottom:16,border:"1px dashed #d9d9d9",padding:16,borderRadius:4}},n.createElement(o.A,{gutter:16},n.createElement(i.A,{span:12},n.createElement(r.A.Item,{name:["workExperience",t,"company"],label:"公司名称",rules:[{required:!0,message:"请输入公司名称"}]},n.createElement(d.A,{placeholder:"公司名称"}))),n.createElement(i.A,{span:12},n.createElement(r.A.Item,{name:["workExperience",t,"position"],label:"职位",rules:[{required:!0,message:"请输入职位"}]},n.createElement(d.A,{placeholder:"职位"})))),n.createElement(o.A,{gutter:16},n.createElement(i.A,{span:12},n.createElement(r.A.Item,{name:["workExperience",t,"startDate"],label:"开始日期"},n.createElement(d.A,{type:"date"}))),n.createElement(i.A,{span:12},n.createElement(r.A.Item,{name:["workExperience",t,"endDate"],label:"结束日期"},n.createElement(d.A,{type:"date"})))),n.createElement(r.A.Item,{name:["workExperience",t,"description"],label:"工作描述"},n.createElement(d.A.TextArea,{rows:3,placeholder:"工作职责和成就"})),q.length>1&&n.createElement(u.Ay,{type:"dashed",danger:!0,onClick:()=>(e=>{const t=[...q];t.splice(e,1),O(t)})(t),style:{marginTop:8}},"删除此工作经验")))),n.createElement(u.Ay,{type:"dashed",onClick:()=>{O([...q,{}])},block:!0},"+ 添加工作经验")),n.createElement(m.A,{title:"教育经历",style:{marginBottom:16}},M.map(((e,t)=>n.createElement("div",{key:t,style:{marginBottom:16,border:"1px dashed #d9d9d9",padding:16,borderRadius:4}},n.createElement(o.A,{gutter:16},n.createElement(i.A,{span:12},n.createElement(r.A.Item,{name:["education",t,"school"],label:"学校名称",rules:[{required:!0,message:"请输入学校名称"}]},n.createElement(d.A,{placeholder:"学校名称"}))),n.createElement(i.A,{span:12},n.createElement(r.A.Item,{name:["education",t,"degree"],label:"学位",rules:[{required:!0,message:"请输入学位"}]},n.createElement(d.A,{placeholder:"学位"})))),n.createElement(o.A,{gutter:16},n.createElement(i.A,{span:12},n.createElement(r.A.Item,{name:["education",t,"startDate"],label:"开始日期"},n.createElement(d.A,{type:"date"}))),n.createElement(i.A,{span:12},n.createElement(r.A.Item,{name:["education",t,"endDate"],label:"结束日期"},n.createElement(d.A,{type:"date"})))),n.createElement(r.A.Item,{name:["education",t,"major"],label:"专业"},n.createElement(d.A,{placeholder:"专业"})),M.length>1&&n.createElement(u.Ay,{type:"dashed",danger:!0,onClick:()=>(e=>{const t=[...M];t.splice(e,1),N(t)})(t),style:{marginTop:8}},"删除此教育经历")))),n.createElement(u.Ay,{type:"dashed",onClick:()=>{N([...M,{}])},block:!0},"+ 添加教育经历")),n.createElement(r.A.Item,{name:"skills",label:"技能"},n.createElement(p.A,{mode:"tags",style:{width:"100%"},placeholder:"输入技能并按回车添加",onChange:e=>Y(e)})),n.createElement(r.A.Item,{name:"coverLetter",label:"求职信",rules:[{required:!0,message:"请填写求职信"}]},n.createElement(d.A.TextArea,{rows:6})),n.createElement(r.A.Item,null,n.createElement(u.Ay,{type:"primary",htmlType:"submit"},"提交申请")))))}}}]);
//# sourceMappingURL=46.bundle.js.map