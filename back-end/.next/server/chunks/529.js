"use strict";exports.id=529,exports.ids=[529],exports.modules={9529:(e,t,s)=>{s.d(t,{l:()=>authMiddleware,p:()=>roleCheck});var r=s(9344),a=s.n(r);function authMiddleware(e){return async(t,s)=>{try{let r=t.headers.authorization;if(!r||!r.startsWith("Bearer "))return s.status(401).json({code:401,message:"未提供token",data:null});let n=r.split(" ")[1],o=process.env.JWT_SECRET;if(!o)return console.error("警告: JWT_SECRET 环境变量未设置"),s.status(500).json({code:500,message:"服务器配置错误",data:null});try{let r=a().verify(n,o);return t.user=r,e(t,s)}catch(e){return s.status(401).json({code:401,message:"无效的token",data:null})}}catch(e){return console.error("认证中间件错误:",e),s.status(500).json({code:500,message:"服务器错误",data:null})}}}function roleCheck(e){return t=>async(s,r)=>{try{let a=s.user;if(!a)return r.status(401).json({code:401,message:"请先登录",data:null});if(!e.includes(a.role))return r.status(403).json({code:403,message:"权限不足",data:null});return t(s,r)}catch(e){return console.error("角色检查中间件错误:",e),r.status(500).json({code:500,message:"服务器错误",data:null})}}}}};