"use strict";(()=>{var e={};e.id=120,e.ids=[120],e.modules={9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},147:(e,r,t)=>{t.r(r),t.d(r,{config:()=>f,default:()=>m,routeModule:()=>j});var s={};t.r(s),t.d(s,{default:()=>p});var a=t(1802),n=t(7153),o=t(6249),d=t(7147),i=t.n(d),l=t(1017),u=t.n(l),c=t(9529);async function handler(e,r){if("POST"!==e.method)return r.status(405).json({code:405,message:"方法不允许",data:null});try{let{fileName:t,chunks:s}=e.body;if(!t||!s)return r.status(400).json({code:400,message:"参数不完整",data:null});let a=u().join(process.cwd(),"uploads","temp",t),n=u().join(process.cwd(),"uploads","files");i().existsSync(n)||i().mkdirSync(n,{recursive:!0});for(let e=0;e<parseInt(s);e++){let t=u().join(a,`${e}`);if(!i().existsSync(t))return r.status(400).json({code:400,message:`分片 ${e} 缺失，合并失败`,data:null})}let o=u().join(n,t),d=i().createWriteStream(o);for(let e=0;e<parseInt(s);e++){let r=u().join(a,`${e}`),t=i().readFileSync(r);d.write(t),i().unlinkSync(r)}d.end(),i().rmdirSync(a);let l=encodeURIComponent(t),c=`/files/${l}`;return r.status(200).json({code:200,message:"文件合并成功",data:{url:c}})}catch(e){return console.error(e),r.status(500).json({code:500,message:"服务器错误",data:null})}}let p=(0,c.l)(handler),m=(0,o.l)(s,"default"),f=(0,o.l)(s,"config"),j=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/upload/merge",pathname:"/api/upload/merge",bundlePath:"",filename:""},userland:s})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[222,529],()=>__webpack_exec__(147));module.exports=t})();