"use strict";(()=>{var e={};e.id=744,e.ids=[744],e.modules={9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6705:e=>{e.exports=import("formidable")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},3503:(e,r,a)=>{a.a(e,async(e,s)=>{try{a.r(r),a.d(r,{config:()=>l,default:()=>c,routeModule:()=>d});var t=a(1802),n=a(7153),o=a(6249),u=a(8618),i=e([u]);u=(i.then?(await i)():i)[0];let c=(0,o.l)(u,"default"),l=(0,o.l)(u,"config"),d=new t.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/upload/chunk",pathname:"/api/upload/chunk",bundlePath:"",filename:""},userland:u});s()}catch(e){s(e)}})},8618:(e,r,a)=>{a.a(e,async(e,s)=>{try{a.r(r),a.d(r,{config:()=>d,default:()=>p});var t=a(6705),n=a(7147),o=a.n(n),u=a(1017),i=a.n(u),c=a(9529),l=e([t]);t=(l.then?(await l)():l)[0];let d={api:{bodyParser:!1}};async function handler(e,r){if("POST"!==e.method)return r.status(405).json({code:405,message:"方法不允许",data:null});try{let a=i().join(process.cwd(),"uploads","temp");o().existsSync(a)||o().mkdirSync(a,{recursive:!0});let s=new t.IncomingForm({uploadDir:a,keepExtensions:!0,multiples:!0,maxFileSize:20971520});return new Promise((t,n)=>{s.parse(e,async(e,s,n)=>{if(e)return console.error("解析表单错误:",e),r.status(500).json({code:500,message:"上传失败",data:null}),t();try{let e=n.chunk?.[0]||n.chunk,u=Array.isArray(s.fileName)?s.fileName[0]:s.fileName,c=Array.isArray(s.chunkIndex)?s.chunkIndex[0]:s.chunkIndex,l=Array.isArray(s.chunks)?s.chunks[0]:s.chunks;if(!e||!u||void 0===c||!l)return console.error("参数不完整:",{chunk:e,fileName:u,chunkIndex:c,chunks:l}),r.status(400).json({code:400,message:"参数不完整",data:null}),t();let d=i().join(a,u);o().existsSync(d)||o().mkdirSync(d,{recursive:!0});let p=e.filepath||e.path;if(!p)return console.error("无法获取文件路径:",e),r.status(500).json({code:500,message:"无法获取文件路径",data:null}),t();let m=i().join(d,`${c}`);return o().renameSync(p,m),r.status(200).json({code:200,message:"分片上传成功",data:{chunkIndex:c,totalChunks:l}}),t()}catch(e){return console.error("处理分片错误:",e),r.status(500).json({code:500,message:"处理分片失败",data:null}),t()}})})}catch(e){return console.error("服务器错误:",e),r.status(500).json({code:500,message:"服务器错误",data:null})}}let p=(0,c.l)(handler);s()}catch(e){s(e)}})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),a=r.X(0,[222,529],()=>__webpack_exec__(3503));module.exports=a})();