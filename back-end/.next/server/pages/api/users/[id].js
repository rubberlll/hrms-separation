"use strict";(()=>{var e={};e.id=56,e.ids=[56],e.modules={9344:e=>{e.exports=require("jsonwebtoken")},1185:e=>{e.exports=require("mongoose")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7618:e=>{e.exports=import("bcryptjs")},8385:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{config:()=>i,default:()=>u,routeModule:()=>c});var r=a(1802),n=a(7153),d=a(6249),o=a(6828),l=e([o]);o=(l.then?(await l)():l)[0];let u=(0,d.l)(o,"default"),i=(0,d.l)(o,"config"),c=new r.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/users/[id]",pathname:"/api/users/[id]",bundlePath:"",filename:""},userland:o});s()}catch(e){s(e)}})},6828:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{default:()=>l});var r=a(5011),n=a(8444),d=a(9529),o=e([n]);async function handler(e,t){let{id:a}=e.query;if("GET"===e.method)try{await (0,r.Z)();let e=await n.Z.findById(a).select("-password").populate("department","name");if(!e)return t.status(404).json({code:404,message:"用户不存在",data:null});let s={key:e._id,username:e.username,email:e.email,phone:e.phone||"",role:e.role,status:e.status,department:e.department?e.department.name:"",departmentId:e.department||"",entryDate:e.entryDate?new Date(e.entryDate).toISOString().split("T")[0]:"",employmentType:e.employmentType||"",avatar:e.avatar||"",createdAt:e.createdAt};return t.status(200).json({code:200,message:"获取用户详情成功",data:s})}catch(e){return console.error(e),t.status(500).json({code:500,message:"服务器错误",data:null})}else if("PUT"===e.method)try{await (0,r.Z)();let s=e.body;delete s.password;let d=await n.Z.findByIdAndUpdate(a,s,{new:!0,runValidators:!0}).select("-password");if(!d)return t.status(404).json({code:404,message:"用户不存在",data:null});return t.status(200).json({code:200,message:"更新用户信息成功",data:d})}catch(e){return console.error(e),t.status(500).json({code:500,message:"服务器错误",data:null})}else if("DELETE"!==e.method)return t.status(405).json({code:405,message:"方法不允许",data:null});else try{await (0,r.Z)();let e=await n.Z.findByIdAndDelete(a);if(!e)return t.status(404).json({code:404,message:"用户不存在",data:null});return t.status(200).json({code:200,message:"删除用户成功",data:null})}catch(e){return console.error(e),t.status(500).json({code:500,message:"服务器错误",data:null})}}n=(o.then?(await o)():o)[0];let l=(0,d.l)((0,d.p)(["admin","hr"])(handler));s()}catch(e){s(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[222,529,227],()=>__webpack_exec__(8385));module.exports=a})();